<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/layout1}">

<head>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/itemDetail.css}">
    </th:block>
</head>

<body>
<div layout:fragment="content" class="content">

    <div class="container" style="max-width: 900px; margin-top: 40px;">

        <div class="row">

            <!-- 이미지 영역 -->
            <div class="col-md-6">
                <img th:src="@{'/images/' + ${#strings.toLowerCase(item.itemCategory)} + '/' + ${item.imgName}}"
                     class="img-fluid rounded shadow-sm" alt="상품 이미지"/>
            </div>

            <!-- 상품 정보 -->
            <div class="col-md-6">

                <h2 th:text="${item.itemNm}">상품명</h2>
                <p class="text-muted" th:text="${item.itemType}">유형</p>
                <h4 class="fw-bold mb-4" th:text="${item.price} + '원'">가격</h4>

                <!-- 색상 -->
                <p>
                    <span class="fw-bold">색상:</span>
                    <span th:text="${item.color1}"></span>
                    <span th:if="${item.color2}"> / <span th:text="${item.color2}"></span></span>
                    <span th:if="${item.color3}"> / <span th:text="${item.color3}"></span></span>
                </p>

                <!-- 수량 -->
                <div class="mt-3">
                    <label for="count" class="fw-bold">수량</label>
                    <input type="number" id="count" class="form-control w-25" min="1" value="1">
                </div>

                <!-- 장바구니 버튼 -->
                <div class="mt-4">
                    <button class="btn btn-primary"
                            th:onclick="'addToCart(' + ${item.id} + ')'" >
                        장바구니 담기
                    </button>
                </div>

            </div>
        </div>

    </div>

</div>

<!-- 페이지 전용 script -->
<th:block layout:fragment="script">
<script>
    function addToCart(itemId) {
        const count = document.getElementById("count").value;

        fetch('/cart', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'itemId=' + itemId + '&count=' + count
        })
            .then(res => {
                if (!res.ok) return res.text().then(text => {throw new Error(text)});
                return res.text();
            })
            .then(msg => {
                if (confirm(msg + "\n장바구니로 이동하시겠습니까?")) {
                    location.href = "/cart";
                }
            })
            .catch(err => {
                if (err.message === "로그인이 필요합니다.") {
                    if (confirm("로그인이 필요합니다. 로그인 페이지로 이동할까요?")) {
                        location.href = "/login";
                    }
                } else {
                    alert("에러 발생: " + err.message);
                }
            });
    }
</script>
</th:block>

</body>
</html>
